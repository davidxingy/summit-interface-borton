{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Patient-facing/summit-interface data passing schema",
  "description": "v0.03",
  "examples": [
    
    {
      "message_type": "get",
      "message": "device"
    },

    {
      "message_type": "post",
      "message": "stim_on"
    },

    {
      "message_type": "result",
      "message": "device",
      "payload": {
		"battery" : 99,
        "stim_on": true
      }
    },

    {
      "message_type": "result",
      "message": "sense_off",
      "payload": {
        "success": true
      }
    },

    {
      "message_type": "result",
      "message": "stim_on",
      "payload": {
        "success": false,
        "error_code": 1,
        "error_message": "Not enough battery"
      }
    }

  ],

  "definitions": {

    "command_result": {
      "description": "object that is returned in 'payload' when sense/stim is turned on/off",
      "type": "object",
      "properties": {

        "success": {
          "description": "whether the command was successfully executed on the INS or not",
          "type": "boolean"
        }
        
      },

      "if": {
        "properties": { "success": {"const": false} }
      },

      "then": {
        "properties": {

          "error_code": {
            "description": "If it wasn't successfully executed, this is the error code",
            "type": "integer",
            "minimum": 0
          },

          "error_message": {
            "description": "If it wasn't successfully executed, this is a short description of the error",
            "type": "string"
          }

        },
        "required": [ "error_code", "error_message"]
      },

      "required": ["success"]
    }

  },

  "type": "object",
  "properties": {

    "message_type": {
      "description": "What type of message this is (e.g. status request, or stim/sense change to the summit interface program, or, a request/change result message from the summit interface program",
      "type": "string",
      "enum": ["get", "post", "result"]
    },

    "message": {
      "description": "The specific request/command/result",
      "type": "string",
      "enum": ["battery", "sense_status", "stim_status", "sense_on", "sense_off", "stim_on", "stim_off"]
    }
  },

  "if": {
    "properties": { "message_type": {"const": "result"} } 
  },

  "then": {

    "allOf" : [

      {"if": {
        "properties": { "message": {"const": "battery"} }
      },

      "then": {
        "properties": {

          "payload": {
            "description": "For battery status requests, use this payload structure",
            "type": "object",
            "properties": {

              "battery_level": {
                "description": "float containing the battery level from 0-100%",
                "type": "number",
                "minimum": 0,
                "maximum": 100

              }
            },
            "required": ["battery_level"]

          }
        }
      } },

      {"if": {
        "properties": { "message": {"const": "sense_status"} }
      },

      "then": {
        "properties": {

          "payload": {
            "description": "For sense status requests, use this payload structure",
            "type": "object",
            "properties": {

              "sense_on": {
                "description": "Whether sensing is turned on or not",
                "type": "boolean"
              }

            },
            "required": ["sense_on"]
          }

        }
      } },

      {"if": {
        "properties": { "message": {"const": "stim_status"} }
      },

      "then": {
        "properties": {
          
          "payload": {
            "description": "For stim status requests, use this payload structure",
            "type": "object",
            "properties": {

              "stim_on": {
                "description": "Whether stim is turned on or not",
                "type": "boolean"
              }

            },
            "required": ["stim_on"]
          }

        }
      } },

      {"if": {
        "properties": { "message": {"const": "sense_on"} }
      },

      "then": {
        "properties": {

          "payload": {
            "description": "Payload structure for the result of a command to turn sensing on",
            "$ref": "#/definitions/command_result"
          }

        }
      } },

      {"if": {
        "properties": { "message": {"const": "sense_off"} }
      },

      "then": {
        "properties": {

          "payload": {
            "description": "Payload structure for the result of a command to turn sensing off",
            "$ref": "#/definitions/command_result"
          }

        }
      } },

      {"if": {
        "properties": { "message": {"const": "stim_on"} }
      },

      "then": {
        "properties": {

          "payload": {
            "description": "Payload structure for the result of a command to turn stim on",
            "$ref": "#/definitions/command_result"
          }

        }
      } },

      {"if": {
        "properties": { "message": {"const": "stim_off"} }
      },

      "then": {
        "properties": {

          "payload": {
            "description": "Payload structure for the result of a command to turn stim off",
            "$ref": "#/definitions/command_result"
          }

        }
      } },
    ],

    "required": ["payload"]
  }, 

  "required": ["message_type","message"]

}